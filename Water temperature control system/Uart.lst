C51 COMPILER V9.50a   UART                                                                 12/11/2018 21:57:51 PAGE 1   


C51 COMPILER V9.50a, COMPILATION OF MODULE UART
OBJECT MODULE PLACED IN Uart.obj
COMPILER INVOKED BY: D:\c51\C51\BIN\C51.EXE scr\Uart.c BROWSE DEBUG OBJECTEXTEND PRINT(.\Uart.lst) TABS(2) OBJECT(Uart.o
                    -bj)

line level    source

   1          /*
   2          **********************************************************************
   3          *                         头文件包含
   4          **********************************************************************
   5          */
   6          #include "Uart.h"
   7          
   8          /*
   9          **********************************************************************
  10          *                         本地宏定义
  11          **********************************************************************
  12          */
  13          
  14          
  15          /*
  16          **********************************************************************
  17          *                         本地全局变量
  18          **********************************************************************
  19          */
  20          extern u8 Temperature_Set;
  21          extern u8 Receive_Flag;
  22          extern u8 T_Single;
  23          extern u8 T_Decade;
  24          extern double Err_Last,Err_Integral;
  25          /*
  26          **********************************************************************
  27          *                         函数原型声明
  28          **********************************************************************
  29          */
  30          void UartInit(void);
  31          void UartSendByte(u8 c);
  32          
  33          
  34          /*********************************************************************
  35          * 函 数 名       : UartInit
  36          * 函数功能     : 串口初始化为9600波特率，8位数据位
  37          * 参数列表       : 无
  38          * 函数输出       : 无
  39          *********************************************************************/
  40          void UartInit(void)
  41          {
  42   1          TMOD = 0x20;    // T1设置为8位自动重装载定时器      
  43   1          SCON = 0x50;    // 串口工作在模式1：8位UART波特率可变，且允许接收
  44   1          TH1 = 0xFA;     // 单片机小精灵V1.3算出的2400波特率且波特率
  45   1          TL1 = TH1;      // 加倍时的定时器设置值。
  46   1          PCON = 0x80;    // 设置为波特率加倍
  47   1        EA = 1;       // 开总中断
  48   1        ES = 1;         // 开串口中断
  49   1        TR1 = 1;        // 定时器1开启计数
  50   1      }
  51          
  52          
  53          /*********************************************************************
  54          * 函 数 名       : UartSendByte
C51 COMPILER V9.50a   UART                                                                 12/11/2018 21:57:51 PAGE 2   

  55          * 函数功能     : 通过串口发送1字节数据给外部设备
  56          * 参数列表       : c - 待发送的1字节数据
  57          * 函数输出       : 无
  58          *********************************************************************/
  59          void UartSendByte(u8 c)
  60          {
  61   1          SBUF = c;
  62   1          while (!TI);
  63   1          TI = 0;
  64   1      }
  65          
  66          
  67          /*********************************************************************
  68          * 函 数 名       : UartIsr
  69          * 函数功能     : 串口的中断处理程序
  70          * 参数列表       : 无
  71          * 函数输出       : 无
  72          *********************************************************************/
  73          void UartIsr(void) interrupt 4  // 注意串口中断的编号是4
  74          {
  75   1        u8 c = 0;           // 临时变量用于存储串口中断接收的字符
  76   1      
  77   1          if (RI)           // 串口接收中断
  78   1          {
  79   2              RI = 0;
  80   2              //add your code here!
  81   2          c = SBUF;       // 通过串口接收外部发送的字符
  82   2      //    UartSendByte(c);
  83   2          if(Receive_Flag == 2)
  84   2          {
  85   3            T_Decade = c - '0';
  86   3            Receive_Flag = 1; 
  87   3          }
  88   2              else if(Receive_Flag == 1)
  89   2          {
  90   3            T_Single = c - '0';
  91   3            Receive_Flag = 0;
  92   3            Err_Last = 0;
  93   3            Err_Integral = 0;
  94   3            Temperature_Set = T_Decade*10+T_Single;
  95   3              
  96   3          }
  97   2          else if(c == 't')
  98   2          {
  99   3            Receive_Flag = 2;
 100   3          }
 101   2          else
 102   2          {}
 103   2      
 104   2          }
 105   1          else            // 串口发送中断
 106   1              TI = 0;         // if else中如果只有1句代码则可不加大括号
 107   1      }
 108          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    131    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
C51 COMPILER V9.50a   UART                                                                 12/11/2018 21:57:51 PAGE 3   

   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
